<!--
Reality-Based MkDocs Theme - Status Macros
Created: 2025-06-19 with user permission
Purpose: Reusable Jinja2 macros for status-aware documentation

These macros provide consistent status indicators and components
that reflect actual implementation status.
-->

<!-- Feature Status Badge Macro -->
{% macro status_badge(status, text=None) %}
{% set badge_text = text or status.title() %}
{% set icons = {
  'available': '✅',
  'verified': '🧪', 
  'tested': '🧪',
  'partial': '⚠️',
  'planned': '🚧',
  'broken': '❌',
  'warning': '⚠️'
} %}
<span class="status-badge status-{{ status }}">
  <span class="badge-icon">{{ icons[status] or '•' }}</span>
  <span class="badge-text">{{ badge_text }}</span>
</span>
{% endmacro %}

<!-- Feature Card Macro -->
{% macro feature_card(title, status, description, what_works=[], limitations=[], resources=[], last_verified=None, coverage=None) %}
<div class="feature-card {{ status }}">
  <div class="feature-header">
    <h3 class="feature-title">{{ title }}</h3>
    <div class="feature-badges">
      {{ status_badge(status) }}
      {% if status in ['available', 'verified'] and coverage %}
        {{ status_badge('verified', 'Tested') }}
      {% endif %}
    </div>
  </div>
  
  <div class="feature-description">
    <p>{{ description }}</p>
  </div>
  
  <div class="feature-details">
    {% if what_works %}
    <div class="feature-section">
      <h4 class="section-title">✅ What Works</h4>
      <ul class="feature-list">
        {% for item in what_works %}
        <li>{{ item }}</li>
        {% endfor %}
      </ul>
    </div>
    {% endif %}
    
    {% if limitations %}
    <div class="feature-section">
      <h4 class="section-title">⚠️ Current Limitations</h4>
      <ul class="feature-list">
        {% for item in limitations %}
        <li>{{ item }}</li>
        {% endfor %}
      </ul>
    </div>
    {% endif %}
    
    {% if resources %}
    <div class="feature-section">
      <h4 class="section-title">🔗 Resources</h4>
      <ul class="feature-list">
        {% for resource in resources %}
        <li><a href="{{ resource.url }}" class="feature-link">{{ resource.title }}</a></li>
        {% endfor %}
      </ul>
    </div>
    {% endif %}
  </div>
  
  {% if last_verified or coverage %}
  <div class="verification-meta">
    {% if last_verified %}
    <span class="last-verified recent">Last verified: {{ last_verified }}</span>
    {% endif %}
    {% if coverage %}
    <span class="coverage-indicator coverage-high">
      Test coverage: 
      <div class="coverage-bar">
        <div class="coverage-fill" style="width: {{ coverage }}%"></div>
      </div>
      {{ coverage }}%
    </span>
    {% endif %}
  </div>
  {% endif %}
</div>
{% endmacro %}

<!-- Code Example Macro -->
{% macro code_example(title, code, language='python', status='tested', output=None, test_info=None, last_verified=None) %}
<div class="code-example {{ status }}">
  <div class="code-header">
    <h4 class="code-title">{{ title }}</h4>
    <div class="code-status">
      {% if status == 'tested' %}
      <span class="test-indicator passing">Passes all tests</span>
      {% elif status == 'partial' %}
      <span class="test-indicator">Limited testing</span>
      {% elif status == 'broken' %}
      <span class="test-indicator failing">Known issues</span>
      {% endif %}
      {{ status_badge(status) }}
    </div>
  </div>
  
  <div class="code-block">
    <pre><code class="language-{{ language }}">{{ code }}</code></pre>
  </div>
  
  {% if output %}
  <div class="code-output">
    <h5>Expected Output:</h5>
    <pre class="output-text">{{ output }}</pre>
  </div>
  {% endif %}
  
  {% if test_info or last_verified %}
  <div class="verification-meta">
    {% if test_info %}
    <span class="test-info">✓ {{ test_info }}</span>
    {% endif %}
    {% if last_verified %}
    <span class="last-verified recent">Last verified: {{ last_verified }}</span>
    {% endif %}
  </div>
  {% endif %}
</div>
{% endmacro %}

<!-- Implementation Gap Warning Macro -->
{% macro implementation_gap(title, description, known_issues=[], workarounds=[], status='Improvement planned') %}
<div class="implementation-gap">
  <div class="admonition-title">{{ title }}</div>
  <div class="admonition-content">
    <p>{{ description }}</p>
    
    {% if known_issues %}
    <div class="gap-section">
      <strong>Known Issues:</strong>
      <ul>
        {% for issue in known_issues %}
        <li>{{ issue }}</li>
        {% endfor %}
      </ul>
    </div>
    {% endif %}
    
    {% if workarounds %}
    <div class="gap-section">
      <strong>Workarounds:</strong>
      <ul>
        {% for workaround in workarounds %}
        <li>{{ workaround }}</li>
        {% endfor %}
      </ul>
    </div>
    {% endif %}
    
    <div class="gap-status">
      <strong>Status:</strong> {{ status }}
    </div>
  </div>
</div>
{% endmacro %}

<!-- System Status Dashboard Macro -->
{% macro system_status(available_count=0, verified_count=0, partial_count=0, planned_count=0, summary_text='') %}
<div class="system-status">
  <h3 class="status-title">System Status Overview</h3>
  
  <div class="status-grid">
    <div class="status-item available">
      <div class="status-count">{{ available_count }}</div>
      <div class="status-label">Available Features</div>
    </div>
    
    <div class="status-item verified">
      <div class="status-count">{{ verified_count }}</div>
      <div class="status-label">Fully Tested</div>
    </div>
    
    <div class="status-item partial">
      <div class="status-count">{{ partial_count }}</div>
      <div class="status-label">Partial Implementation</div>
    </div>
    
    <div class="status-item planned">
      <div class="status-count">{{ planned_count }}</div>
      <div class="status-label">Planned Features</div>
    </div>
  </div>
  
  {% if summary_text %}
  <div class="status-details">
    <p class="status-summary">{{ summary_text }}</p>
  </div>
  {% endif %}
</div>
{% endmacro %}

<!-- Status Table Macro -->
{% macro status_table(features) %}
<table class="status-table">
  <thead>
    <tr>
      <th>Feature</th>
      <th>Status</th>
      <th>Test Coverage</th>
      <th>Last Verified</th>
      <th>Notes</th>
    </tr>
  </thead>
  <tbody>
    {% for feature in features %}
    <tr>
      <td><strong>{{ feature.name }}</strong></td>
      <td class="status-cell">{{ status_badge(feature.status) }}</td>
      <td class="status-cell">
        {% if feature.coverage %}
        <div class="coverage-indicator coverage-{{ 'high' if feature.coverage >= 90 else 'medium' if feature.coverage >= 70 else 'low' }}">
          <div class="coverage-bar">
            <div class="coverage-fill" style="width: {{ feature.coverage }}%"></div>
          </div>
          {{ feature.coverage }}%
        </div>
        {% else %}
        <span class="text-muted">N/A</span>
        {% endif %}
      </td>
      <td class="status-cell">
        {% if feature.last_verified %}
        <span class="last-verified recent">{{ feature.last_verified }}</span>
        {% else %}
        <span class="text-muted">Not verified</span>
        {% endif %}
      </td>
      <td>{{ feature.notes or '' }}</td>
    </tr>
    {% endfor %}
  </tbody>
</table>
{% endmacro %}

<!-- Quick Status Inline Macro -->
{% macro quick_status(status) %}
{% set status_info = {
  'available': {'icon': '✅', 'text': 'Ready for use', 'class': 'text-success'},
  'verified': {'icon': '🧪', 'text': 'Tested', 'class': 'text-info'},
  'partial': {'icon': '⚠️', 'text': 'Limited', 'class': 'text-warning'},
  'planned': {'icon': '🚧', 'text': 'Coming soon', 'class': 'text-muted'},
  'broken': {'icon': '❌', 'text': 'Not working', 'class': 'text-danger'}
} %}
{% set info = status_info[status] %}
<span class="{{ info.class }}" title="{{ info.text }}">
  {{ info.icon }} {{ info.text }}
</span>
{% endmacro %}

<!-- Verification Badge Macro -->
{% macro verification_badge(date, coverage=None) %}
<div class="verification-meta">
  <span class="last-verified recent">🕐 Last verified: {{ date }}</span>
  {% if coverage %}
  <span class="coverage-indicator coverage-{{ 'high' if coverage >= 90 else 'medium' if coverage >= 70 else 'low' }}">
    Test coverage: 
    <div class="coverage-bar">
      <div class="coverage-fill" style="width: {{ coverage }}%"></div>
    </div>
    {{ coverage }}%
  </span>
  {% endif %}
</div>
{% endmacro %}

<!-- Usage Example Macro -->
{% macro usage_example() %}
<!-- Usage examples for the macros above -->

<!-- Basic status badge -->
{{ status_badge('available') }}
{{ status_badge('verified', 'Tested & Working') }}

<!-- Feature card -->
{{ feature_card(
  title='LocomotionData Library',
  status='available',
  description='Core library for loading and analyzing phase-indexed locomotion data.',
  what_works=[
    '3D array operations for gait cycle analysis',
    'Data quality assessment and outlier detection',
    'Publication-ready visualization tools'
  ],
  limitations=[
    'Requires exact 150 points per gait cycle',
    'Phase-indexed data works best'
  ],
  resources=[
    {'title': 'API Documentation', 'url': '#api'},
    {'title': 'Working Examples', 'url': '#examples'}
  ],
  last_verified='2025-06-19',
  coverage=95
) }}

<!-- Code example -->
{{ code_example(
  title='Loading Locomotion Data',
  code='from locomotion_analysis import LocomotionData\nloco = LocomotionData("dataset_phase.parquet")',
  status='tested',
  output='Data validation passed: 12 subjects, 3 tasks',
  test_info='Tested with demo_clean_phase.parquet',
  last_verified='2025-06-19'
) }}

<!-- System status dashboard -->
{{ system_status(
  available_count=8,
  verified_count=6,
  partial_count=2,
  planned_count=3,
  summary_text='95% of core features are available and tested. The system is ready for production use.'
) }}

{% endmacro %}